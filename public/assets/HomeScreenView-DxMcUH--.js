var ue=e=>{throw TypeError(e)};var q=(e,t,s)=>t.has(e)||ue("Cannot "+s);var i=(e,t,s)=>(q(e,t,"read from private field"),s?s.call(e):t.get(e)),x=(e,t,s)=>t.has(e)?ue("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,s),f=(e,t,s,r)=>(q(e,t,"write to private field"),r?r.call(e,s):t.set(e,s),s),m=(e,t,s)=>(q(e,t,"access private method"),s);import{c as Ce,p as de,d as S,s as K,e as z,n as je,i as Z,f as fe,t as Ie,g as we,h as Se,k as pe,l as ve,r as j,m as Ne,S as Te,j as a,A as Oe,o as Ee,L as De,b as Qe}from"./index-DjI7ZG_S.js";import{S as ke}from"./SequentialAnimation-BW8I0Pk3.js";import{I as Fe}from"./InfoCard-4PesH3Ea.js";import"./proxy-B0VEXGqS.js";var C,o,H,y,Q,A,E,w,$,L,_,k,F,D,M,c,G,X,ee,te,se,ie,re,ae,ye,be,Ue=(be=class extends Ce{constructor(t,s){super();x(this,c);x(this,C);x(this,o);x(this,H);x(this,y);x(this,Q);x(this,A);x(this,E);x(this,w);x(this,$);x(this,L);x(this,_);x(this,k);x(this,F);x(this,D);x(this,M,new Set);this.options=s,f(this,C,t),f(this,w,null),f(this,E,de()),this.options.experimental_prefetchInRender||i(this,E).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(s)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(i(this,o).addObserver(this),me(i(this,o),this.options)?m(this,c,G).call(this):this.updateResult(),m(this,c,se).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return ne(i(this,o),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return ne(i(this,o),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,m(this,c,ie).call(this),m(this,c,re).call(this),i(this,o).removeObserver(this)}setOptions(t,s){const r=this.options,u=i(this,o);if(this.options=i(this,C).defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof S(this.options.enabled,i(this,o))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");m(this,c,ae).call(this),i(this,o).setOptions(this.options),r._defaulted&&!K(this.options,r)&&i(this,C).getQueryCache().notify({type:"observerOptionsUpdated",query:i(this,o),observer:this});const h=this.hasListeners();h&&ge(i(this,o),u,this.options,r)&&m(this,c,G).call(this),this.updateResult(s),h&&(i(this,o)!==u||S(this.options.enabled,i(this,o))!==S(r.enabled,i(this,o))||z(this.options.staleTime,i(this,o))!==z(r.staleTime,i(this,o)))&&m(this,c,X).call(this);const n=m(this,c,ee).call(this);h&&(i(this,o)!==u||S(this.options.enabled,i(this,o))!==S(r.enabled,i(this,o))||n!==i(this,D))&&m(this,c,te).call(this,n)}getOptimisticResult(t){const s=i(this,C).getQueryCache().build(i(this,C),t),r=this.createResult(s,t);return Ae(this,r)&&(f(this,y,r),f(this,A,this.options),f(this,Q,i(this,o).state)),r}getCurrentResult(){return i(this,y)}trackResult(t,s){const r={};return Object.keys(t).forEach(u=>{Object.defineProperty(r,u,{configurable:!1,enumerable:!0,get:()=>(this.trackProp(u),s==null||s(u),t[u])})}),r}trackProp(t){i(this,M).add(t)}getCurrentQuery(){return i(this,o)}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const s=i(this,C).defaultQueryOptions(t),r=i(this,C).getQueryCache().build(i(this,C),s);return r.fetch().then(()=>this.createResult(r,s))}fetch(t){return m(this,c,G).call(this,{...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),i(this,y)))}createResult(t,s){var le;const r=i(this,o),u=this.options,h=i(this,y),n=i(this,Q),b=i(this,A),p=t!==r?t.state:i(this,H),{state:g}=t;let l={...g},N=!1,R;if(s._optimisticResults){const v=this.hasListeners(),U=!v&&me(t,s),P=v&&ge(t,r,s,u);(U||P)&&(l={...l,...Se(g.data,t.options)}),s._optimisticResults==="isRestoring"&&(l.fetchStatus="idle")}let{error:B,errorUpdatedAt:O,status:T}=l;if(s.select&&l.data!==void 0)if(h&&l.data===(n==null?void 0:n.data)&&s.select===i(this,$))R=i(this,L);else try{f(this,$,s.select),R=s.select(l.data),R=pe(h==null?void 0:h.data,R,s),f(this,L,R),f(this,w,null)}catch(v){f(this,w,v)}else R=l.data;if(s.placeholderData!==void 0&&R===void 0&&T==="pending"){let v;if(h!=null&&h.isPlaceholderData&&s.placeholderData===(b==null?void 0:b.placeholderData))v=h.data;else if(v=typeof s.placeholderData=="function"?s.placeholderData((le=i(this,_))==null?void 0:le.state.data,i(this,_)):s.placeholderData,s.select&&v!==void 0)try{v=s.select(v),f(this,w,null)}catch(U){f(this,w,U)}v!==void 0&&(T="success",R=pe(h==null?void 0:h.data,v,s),N=!0)}i(this,w)&&(B=i(this,w),R=i(this,L),O=Date.now(),T="error");const J=l.fetchStatus==="fetching",V=T==="pending",W=T==="error",he=V&&J,ce=R!==void 0,I={status:T,fetchStatus:l.fetchStatus,isPending:V,isSuccess:T==="success",isError:W,isInitialLoading:he,isLoading:he,data:R,dataUpdatedAt:l.dataUpdatedAt,error:B,errorUpdatedAt:O,failureCount:l.fetchFailureCount,failureReason:l.fetchFailureReason,errorUpdateCount:l.errorUpdateCount,isFetched:l.dataUpdateCount>0||l.errorUpdateCount>0,isFetchedAfterMount:l.dataUpdateCount>p.dataUpdateCount||l.errorUpdateCount>p.errorUpdateCount,isFetching:J,isRefetching:J&&!V,isLoadingError:W&&!ce,isPaused:l.fetchStatus==="paused",isPlaceholderData:N,isRefetchError:W&&ce,isStale:oe(t,s),refetch:this.refetch,promise:i(this,E)};if(this.options.experimental_prefetchInRender){const v=Y=>{I.status==="error"?Y.reject(I.error):I.data!==void 0&&Y.resolve(I.data)},U=()=>{const Y=f(this,E,I.promise=de());v(Y)},P=i(this,E);switch(P.status){case"pending":t.queryHash===r.queryHash&&v(P);break;case"fulfilled":(I.status==="error"||I.data!==P.value)&&U();break;case"rejected":(I.status!=="error"||I.error!==P.reason)&&U();break}}return I}updateResult(t){const s=i(this,y),r=this.createResult(i(this,o),this.options);if(f(this,Q,i(this,o).state),f(this,A,this.options),i(this,Q).data!==void 0&&f(this,_,i(this,o)),K(r,s))return;f(this,y,r);const u={},h=()=>{if(!s)return!0;const{notifyOnChangeProps:n}=this.options,b=typeof n=="function"?n():n;if(b==="all"||!b&&!i(this,M).size)return!0;const d=new Set(b??i(this,M));return this.options.throwOnError&&d.add("error"),Object.keys(i(this,y)).some(p=>{const g=p;return i(this,y)[g]!==s[g]&&d.has(g)})};(t==null?void 0:t.listeners)!==!1&&h()&&(u.listeners=!0),m(this,c,ye).call(this,{...u,...t})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&m(this,c,se).call(this)}},C=new WeakMap,o=new WeakMap,H=new WeakMap,y=new WeakMap,Q=new WeakMap,A=new WeakMap,E=new WeakMap,w=new WeakMap,$=new WeakMap,L=new WeakMap,_=new WeakMap,k=new WeakMap,F=new WeakMap,D=new WeakMap,M=new WeakMap,c=new WeakSet,G=function(t){m(this,c,ae).call(this);let s=i(this,o).fetch(this.options,t);return t!=null&&t.throwOnError||(s=s.catch(je)),s},X=function(){m(this,c,ie).call(this);const t=z(this.options.staleTime,i(this,o));if(Z||i(this,y).isStale||!fe(t))return;const r=Ie(i(this,y).dataUpdatedAt,t)+1;f(this,k,setTimeout(()=>{i(this,y).isStale||this.updateResult()},r))},ee=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(i(this,o)):this.options.refetchInterval)??!1},te=function(t){m(this,c,re).call(this),f(this,D,t),!(Z||S(this.options.enabled,i(this,o))===!1||!fe(i(this,D))||i(this,D)===0)&&f(this,F,setInterval(()=>{(this.options.refetchIntervalInBackground||we.isFocused())&&m(this,c,G).call(this)},i(this,D)))},se=function(){m(this,c,X).call(this),m(this,c,te).call(this,m(this,c,ee).call(this))},ie=function(){i(this,k)&&(clearTimeout(i(this,k)),f(this,k,void 0))},re=function(){i(this,F)&&(clearInterval(i(this,F)),f(this,F,void 0))},ae=function(){const t=i(this,C).getQueryCache().build(i(this,C),this.options);if(t===i(this,o))return;const s=i(this,o);f(this,o,t),f(this,H,t.state),this.hasListeners()&&(s==null||s.removeObserver(this),t.addObserver(this))},ye=function(t){ve.batch(()=>{t.listeners&&this.listeners.forEach(s=>{s(i(this,y))}),i(this,C).getQueryCache().notify({query:i(this,o),type:"observerResultsUpdated"})})},be);function Pe(e,t){return S(t.enabled,e)!==!1&&e.state.data===void 0&&!(e.state.status==="error"&&t.retryOnMount===!1)}function me(e,t){return Pe(e,t)||e.state.data!==void 0&&ne(e,t,t.refetchOnMount)}function ne(e,t,s){if(S(t.enabled,e)!==!1){const r=typeof s=="function"?s(e):s;return r==="always"||r!==!1&&oe(e,t)}return!1}function ge(e,t,s,r){return(e!==t||S(r.enabled,e)===!1)&&(!s.suspense||e.state.status!=="error")&&oe(e,s)}function oe(e,t){return S(t.enabled,e)!==!1&&e.isStaleByTime(z(t.staleTime,e))}function Ae(e,t){return!K(e.getCurrentResult(),t)}var Re=j.createContext(!1),Le=()=>j.useContext(Re);Re.Provider;function _e(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var Me=j.createContext(_e()),Be=()=>j.useContext(Me);function Ge(e,t){return typeof e=="function"?e(...t):!!e}function He(){}var $e=(e,t)=>{(e.suspense||e.throwOnError||e.experimental_prefetchInRender)&&(t.isReset()||(e.retryOnMount=!1))},Ye=e=>{j.useEffect(()=>{e.clearReset()},[e])},ze=({result:e,errorResetBoundary:t,throwOnError:s,query:r})=>e.isError&&!t.isReset()&&!e.isFetching&&r&&Ge(s,[e.error,r]),Je=e=>{e.suspense&&(e.staleTime===void 0&&(e.staleTime=1e3),typeof e.gcTime=="number"&&(e.gcTime=Math.max(e.gcTime,1e3)))},Ve=(e,t)=>e.isLoading&&e.isFetching&&!t,We=(e,t)=>(e==null?void 0:e.suspense)&&t.isPending,xe=(e,t,s)=>t.fetchOptimistic(e).catch(()=>{s.clearReset()});function qe(e,t,s){var g,l,N,R,B;const r=Ne(),u=Le(),h=Be(),n=r.defaultQueryOptions(e);(l=(g=r.getDefaultOptions().queries)==null?void 0:g._experimental_beforeQuery)==null||l.call(g,n),n._optimisticResults=u?"isRestoring":"optimistic",Je(n),$e(n,h),Ye(h);const b=!r.getQueryCache().get(n.queryHash),[d]=j.useState(()=>new t(r,n)),p=d.getOptimisticResult(n);if(j.useSyncExternalStore(j.useCallback(O=>{const T=u?()=>{}:d.subscribe(ve.batchCalls(O));return d.updateResult(),T},[d,u]),()=>d.getCurrentResult(),()=>d.getCurrentResult()),j.useEffect(()=>{d.setOptions(n,{listeners:!1})},[n,d]),We(n,p))throw xe(n,d,h);if(ze({result:p,errorResetBoundary:h,throwOnError:n.throwOnError,query:r.getQueryCache().get(n.queryHash)}))throw p.error;if((R=(N=r.getDefaultOptions().queries)==null?void 0:N._experimental_afterQuery)==null||R.call(N,n,p),n.experimental_prefetchInRender&&!Z&&Ve(p,u)){const O=b?xe(n,d,h):(B=r.getQueryCache().get(n.queryHash))==null?void 0:B.promise;O==null||O.catch(He).finally(()=>{d.updateResult()})}return n.notifyOnChangeProps?p:d.trackResult(p)}function Ke(e,t){return qe(e,Ue)}const Ze=({user:e,isLoading:t})=>{var h,n,b,d,p;const s=j.useContext(Te),r=()=>{s.toggle()},u=g=>g==null?void 0:g.split(" ").map(l=>l[0]).join("").toUpperCase().slice(0,2);return a.jsx("div",{className:"bg-white mb-2 p-4 shadow-sm fixed top-0 w-full ",children:a.jsxs("div",{className:"flex items-center space-x-4",children:[!t&&(e!=null&&e.image)?a.jsx("img",{onClick:r,src:`http://localhost:5000/api/${e.image}`,alt:e.name,className:"w-12 h-12 rounded-full  focus:bg-gray-200 hover:outline-none hover:ring-1 hover:ring-offset-1 hover:ring-gray-400"}):a.jsx("div",{onClick:r,className:`${t&&"animate-pulse"} w-12 h-12 rounded-full bg-green-200 text-green-500 flex items-center justify-center font-medium  focus:bg-gray-200 hover:outline-none hover:ring-1 hover:ring-offset-1 hover:ring-gray-400`,children:u(e==null?void 0:e.name)}),a.jsxs("div",{children:[t&&a.jsx("div",{className:"animate-pulse flex space-x-4",children:a.jsxs("div",{className:"flex-1 space-y-3 py-1 grow",children:[a.jsx("div",{className:"h-5 w-36 bg-slate-700 rounded"}),a.jsx("div",{className:"h-3 w-56 bg-slate-400 rounded"})]})}),!t&&a.jsxs(a.Fragment,{children:[a.jsx("h2",{className:"text-xl font-medium",children:e.name||"Unknown"}),a.jsxs("h3",{children:[((n=(h=e.userId)==null?void 0:h.teachingGroupId)==null?void 0:n.name)||"No TeachingGroup"," - ",((p=(d=(b=e.userId)==null?void 0:b.teachingGroupId)==null?void 0:d.branchId)==null?void 0:p.name)||"No Branch"]})]})]})]})})},Xe=({data:e})=>{var t,s;return console.log(JSON.stringify(e)),a.jsxs("div",{className:"my-8",children:[a.jsx("h2",{className:"text-xl font-medium mb-2 ",children:e.name}),a.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[a.jsxs("div",{className:"bg-white p-4 rounded-md shadow",children:[a.jsx("h3",{className:"text-gray-500 text-sm",children:"Jumlah Peserta Didik"}),a.jsx("p",{className:"text-2xl font-bold",children:((t=e.students)==null?void 0:t.length)||"No Data"})]}),a.jsxs("div",{className:"bg-white p-4 rounded-md shadow",children:[a.jsx("h3",{className:"text-gray-500 text-sm",children:"Total Pertemuan"}),a.jsx("p",{className:"text-2xl font-bold",children:e.attendances&&((s=e.teachingGroupYearId)!=null&&s.semesterTarget)?`${(e.attendances.length/e.teachingGroupYearId.semesterTarget/e.students.length*100).toFixed(2)}%`:"No Data"})]})]})]})},et=()=>{const[e,t]=j.useState(new Date);j.useEffect(()=>{const u=setInterval(()=>{t(new Date)},1e3);return()=>{clearInterval(u)}},[]);const s=u=>u.toLocaleDateString("id-ID",{weekday:"long",day:"2-digit",month:"long",year:"numeric",timeZone:"Asia/Jakarta"}),r=u=>u.toLocaleTimeString("id-ID",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit",timeZone:"Asia/Jakarta"});return a.jsxs("div",{className:"space-y-1 mb-2 text-gray-600",children:[a.jsx("div",{className:"font-normal",children:s(e)}),a.jsxs("div",{className:"",children:[r(e)," WIB"]})]})},ot=()=>{const e=j.useContext(Oe);j.useContext(Ee);const t=async()=>{var d,p,g,l;console.log("fetching profile...");const h=await fetch(`http://localhost:5000/api/teachers/user/${e.userId}`);if(!h.ok)throw new Error("Failed to fetch user data");const n=await h.json();console.log(n);const b=((d=n.teacher)==null?void 0:d.classIds.map(N=>N._id))||[];return e.setAttributes((l=(g=(p=n.teacher)==null?void 0:p.userId)==null?void 0:g.teachingGroupId)==null?void 0:l.id,b),n.teacher},{data:s,isLoading:r,error:u}=Ke({queryKey:["teacherData"],queryFn:t,staleTime:1e3*60*5});return a.jsxs("div",{className:"flex flex-col",children:[a.jsx("div",{children:a.jsx(Ze,{user:s,isLoading:r})}),!s&&r&&a.jsx("div",{className:"flex justify-center mt-44",children:a.jsx(De,{size:32})}),s&&!r&&a.jsx(ke,{children:a.jsxs("div",{className:"mt-20 flex-1 p-4",children:[a.jsxs("div",{className:"mb-4 space-y-1",children:[a.jsx("h1",{className:"text-xl font-medium",children:"Tenaga Pendidik"}),a.jsx(et,{})]}),a.jsxs("div",{className:"mb-4",children:[s.classIds.map((h,n)=>{var d,p;if((p=(d=h==null?void 0:h.teachingGroupYearId)==null?void 0:d.academicYearId)==null?void 0:p.isActive)return a.jsx(Xe,{data:h},n)}),s.classIds.length===0&&a.jsxs(Fe,{children:[a.jsx("p",{children:"Belum terdaftar di kelas manapun."}),a.jsxs("p",{children:["Buat kelas baru di ",a.jsx(Qe,{to:"/dashboard/academic",className:"active:text-blue-400 underline",children:"pengaturan akademik"})]})]})]})]})})]})};export{ot as default};
