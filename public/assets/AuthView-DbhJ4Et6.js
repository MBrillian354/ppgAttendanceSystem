import{r as o,A as N,u as v,j as s,L as I}from"./index-D_ufnm_m.js";import{u as S}from"./http-hook-Bu37qFrk.js";import{D as C}from"./DynamicForm-tTOpBJS-.js";import{E}from"./ErrorCard-BcVIfwSZ.js";import{l as G}from"./ppgcikampek-CM1E7Efd.js";import"./iconify-icon-C1YYA-Pd.js";const Y=()=>{const[m,P]=o.useState(!1),{isLoading:i,error:c,sendRequest:l,setError:g}=S();o.useState(""),o.useState(""),o.useState(!1);const h=o.useContext(N),x=v(),y=[{name:"email",label:"Email",placeholder:"Email",type:"email",required:!0},{name:"password",label:"Password",placeholder:"Password",type:"password",required:!0}],w=async p=>{var d,u;const f="https://ppgacademicsystem-production.up.railway.app/api/users/login",b=JSON.stringify({email:p.email,password:p.password});let e,n;try{e=await l(f,"POST",b,{"Content-Type":"application/json"});try{n=await l(`https://ppgacademicsystem-production.up.railway.app/api/teachingGroupYears/teachingGroup/${e.user.teachingGroupId.id}`)}catch{}let t;n&&(t=n.teachingGroupYears.find(a=>a.academicYearId.isActive));let r;if(e.user.role==="teacher")try{r=await l(`https://ppgacademicsystem-production.up.railway.app/api/teachers/user/${e.user.id}`),console.log(r)}catch(a){console.log(a)}console.log("logging IN"),console.log(e);const j=((d=r==null?void 0:r.teacher)==null?void 0:d.classIds.map(a=>a._id))||[];h.login(e.user.id,e.user.role,e.user.name,e.user.teachingGroupId.id,((u=t==null?void 0:t.academicYearId)==null?void 0:u.name)||null,j,e.token),console.log("logged IN")}catch(t){console.log(t)}};return s.jsx("div",{className:"m-auto max-w-md mt-16 md:mt-24",children:s.jsxs("div",{className:`pb-24 transition-opacity duration-300 ${m?"opacity-0":"opacity-100"}`,children:[c&&s.jsx("div",{className:"px-2",children:s.jsx(E,{error:c,onClear:()=>g(null)})}),s.jsx(C,{logo:G,title:"PPG Karawang",subtitle:"Sistem Akademik Digital",fields:y,onSubmit:w,disabled:i,labels:!1,button:s.jsx("div",{className:"flex flex-col justify-stretch mt-4",children:s.jsx("button",{type:"submit",className:`button-primary ${i?"opacity-50 cursor-not-allowed":""}`,disabled:i,children:i?s.jsx(I,{children:"Processing..."}):"Login"})}),helpButton:s.jsx("div",{onClick:()=>x("/reset-password/reset"),className:"text-center mt-2",children:s.jsx("p",{className:"underline text-xs text-gray-600 active:text-primary hover:text-primary hover:cursor-pointer",children:"Reset Password"})})})]})})};export{Y as default};
