import{r as i,u as B,A as G,j as e,L as b,b as y}from"./index-DjI7ZG_S.js";import{u as P}from"./http-hook-D44mLOTF.js";import{M as L}from"./ModalBottomClose-De-hj65x.js";import{F as M}from"./FloatingMenu-BhKB5Qha.js";import{E as O}from"./ErrorCard-Drp33CnV.js";import{T as N}from"./trash-Bt4ltbqE.js";import{P as F}from"./plus-vkBv9P5N.js";import{U as H}from"./users-Cin6MBFW.js";import{C as V}from"./chevron-down-c93HZFi9.js";import{P as z}from"./pencil-B4890S83.js";import"./createLucideIcon-CnKyH5OX.js";const te=()=>{const[h,u]=i.useState();i.useState("");const[r,o]=i.useState({title:"",message:"",onConfirm:null}),[C,c]=i.useState(!1),[d,p]=i.useState([]),[g,v]=i.useState({admin:!0,teachingGroupAdmin:!0,teacher:!0,student:!0}),k=["admin","teachingGroupAdmin","teacher","student"],{isLoading:x,error:f,sendRequest:m,setError:w}=P(),D=B(),E=i.useContext(G);i.useEffect(()=>{(async()=>{try{const t=await m("http://localhost:5000/api/users/");u(t)}catch{}})()},[m]);const U=s=>{v(t=>({...t,[s]:!t[s]}))},j=s=>({admin:"bg-red-100 text-red-700",teachingGroupAdmin:"bg-orange-100 text-orange-700",teacher:"bg-violet-100 text-violet-700",student:"bg-blue-100 text-blue-700"})[s]||"bg-gray-100 text-gray-700",S=s=>s==null?void 0:s.split(" ").map(t=>t[0]).join("").toUpperCase().slice(0,2),$=s=>{o({title:"Peringatan!",message:"Hapus Pengguna?",onConfirm:async()=>{try{const a=await m(`http://localhost:5000/api/users/${s}`,"DELETE",null,{Authorization:"Bearer "+E.token});o({title:"Berhasil!",message:a.message,onConfirm:null}),u(n=>({...n,users:n.users.filter(l=>l._id!==s)}))}catch{}}}),c(!0)},A=()=>{if(d.length===0){o({title:"Error",message:"Please select at least one user.",onConfirm:null}),c(!0);return}o({title:"Konfirmasi",message:"Hapus semua user yang dipilih?",onConfirm:async()=>{const t="http://localhost:5000/api/users/bulk-delete",a=JSON.stringify({userIds:d});console.log(a);try{const n=await m(t,"DELETE",a,{"Content-Type":"application/json"});o({title:"Berhasil!",message:n.message,onConfirm:null}),u(l=>({...l,users:l.users.filter(_=>!d.includes(_._id))})),p([])}catch{}}}),c(!0)},I=()=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("button",{onClick:()=>{c(!1)},className:`${r.onConfirm?"btn-danger-outline":"button-primary mt-0 "}`,children:r.onConfirm?"Batal":"Tutup"}),r.onConfirm&&e.jsx("button",{onClick:r.onConfirm,className:"button-primary mt-0 ",children:"Ya"})]}),T=({user:s})=>{const t=d.includes(s._id),a=()=>{p(n=>t?n.filter(l=>l!==s._id):[...n,s._id])};return e.jsxs("div",{className:"p-4 hover:bg-gray-50 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("input",{type:"checkbox",checked:t,onChange:a,className:"mr-2"}),s.image?e.jsx("img",{src:`http://localhost:5000/api/${s.image}`,alt:s.name,className:"w-10 h-10 rounded-full hidden md:block"}):e.jsx("div",{className:`w-10 h-10 rounded-full hidden md:flex ${j(s.role)} items-center justify-center font-medium`,children:S(s.name)}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:s.name}),e.jsx("span",{className:`px-2.5 py-0.5 rounded-full text-xs font-medium h-6 ${j(s.role)}`,children:s.role})]}),e.jsx("p",{className:"text-sm text-gray-500 hidden md:block",children:s.email})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-gray-900 hidden md:block",children:s.teachingGroupId.branchId.name}),e.jsx("div",{className:"text-xs text-gray-500",children:s.teachingGroupId.name})]}),e.jsx("div",{className:"p-1 hover:bg-gray-100 rounded",children:e.jsx(M,{buttons:[{icon:z,label:"Edit",onClick:()=>D(`/settings/users/${s._id}`)},{icon:N,label:"Delete",variant:"danger",onClick:()=>$(s._id)}]})})]})]})};return e.jsx("div",{className:"min-h-screen bg-gray-50 px-4 py-8 md:p-8",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[f&&e.jsx(O,{error:f,onClear:()=>w(null)}),e.jsxs(L,{isOpen:C,onClose:()=>c(!1),title:r.title,footer:e.jsx(I,{}),children:[x&&e.jsx("div",{className:"flex justify-center mt-16",children:e.jsx(b,{size:32})}),!x&&r.message]}),e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Daftar User"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:A,className:"button-danger disabled:hidden",disabled:d.length===0,children:[e.jsx(N,{className:"w-4 h-4 mr-2"}),"Hapus Akun"]}),e.jsx(y,{to:"/settings/users/new",children:e.jsxs("button",{className:"button-primary pl-[14px]",children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),"Tambah Akun"]})}),e.jsx(y,{to:"/settings/users/bulk-create",children:e.jsxs("button",{className:"button-primary pl-[14px]",children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"Tambah Akun Siswa"]})})]})]}),x&&e.jsx("div",{className:"flex justify-center mt-16",children:e.jsx(b,{size:32})}),h&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"bg-white rounded-md shadow-sm",children:k.map(s=>{const t=h.users.filter(a=>a.role===s);return e.jsxs("div",{className:"divide-y",children:[e.jsxs("div",{className:"bg-gray-100 px-4 py-2 font-semibold text-gray-700 cursor-pointer flex items-center justify-between",onClick:()=>U(s),children:[e.jsx("span",{children:s.charAt(0).toUpperCase()+s.slice(1)}),e.jsx(V,{className:`w-4 h-4 transform transition-transform ${g[s]?"":"-rotate-90"}`})]}),g[s]&&t.map(a=>e.jsx(T,{user:a},a._id))]},s)})})})]})})};export{te as default};
