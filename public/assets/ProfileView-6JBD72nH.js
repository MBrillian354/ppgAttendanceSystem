import{r as i,A as H,j as e,L as m}from"./index-D_ufnm_m.js";import{u as K}from"./http-hook-Bu37qFrk.js";import{E as Y}from"./ErrorCard-BcVIfwSZ.js";import{D as Q,i as p}from"./DynamicForm-tTOpBJS-.js";import{F as W}from"./FileUpload-CH9TJsyy.js";import{M as X}from"./ModalBottomClose-R6qTd47U.js";import"./iconify-icon-C1YYA-Pd.js";const oe=()=>{var N,C,P;const[l,n]=i.useState({title:"",message:"",onConfirm:null}),[k,o]=i.useState(!1),[u,E]=i.useState(""),[h,S]=i.useState(""),[g,$]=i.useState(""),[f,I]=i.useState(""),[t,O]=i.useState(),[x,y]=i.useState(null),[w,U]=i.useState(!1),[j,B]=i.useState(""),[b,A]=i.useState(""),{isLoading:s,error:v,sendRequest:c,setError:T}=K(),d=i.useContext(H),z=i.useRef();i.useEffect(()=>{(async()=>{try{const a=await c(`https://ppgacademicsystem-production.up.railway.app/api/users/${d.userId}`);O(a.users),console.log(a)}catch{}})()},[c,d.userId]);const F=async()=>{const r=new FormData;r.append("image",x);try{const a=await c(`https://ppgacademicsystem-production.up.railway.app/api/users/image-upload/${d.userId}`,"POST",r);console.log(a),n({title:"Berhasil!",message:a.message,onConfirm:null}),o(!0),y(null)}catch(a){n({title:"Gagal!",message:a.message,onConfirm:null}),o(!0)}},G=r=>{E(r.target.value)},D=r=>{S(r.target.value)},L=r=>{$(r.target.value)},M=r=>{I(r.target.value)},R=()=>{U(r=>!r)},V=()=>{n({title:"Verifikasi Email?",message:"Pesan verifikasi akan dikirim ke inbox Anda.",onConfirm:async()=>{try{const a=await c("https://ppgacademicsystem-production.up.railway.app/api/users/request-verify-email","POST",JSON.stringify({email:t.email,newEmail:t.email,isNewEmail:!1}),{"Content-Type":"application/json",Authorization:"Bearer "+d.token});n({title:"Berhasil!",message:a.message,onConfirm:null}),o(!0)}catch(a){n({title:"Gagal!",message:a.message,onConfirm:null}),o(!0)}}}),o(!0)},q=async()=>{if(!u){A(" Email tidak boleh kosong!");return}n({title:"Ubah Email?",message:"Pesan verifikasi akan dikirim ke email baru Anda.",onConfirm:async()=>{try{const a=await c("https://ppgacademicsystem-production.up.railway.app/api/users/request-verify-email","POST",JSON.stringify({email:t.email,newEmail:u,isNewEmail:!0}),{"Content-Type":"application/json",Authorization:"Bearer "+d.token});n({title:"Berhasil!",message:a.message,onConfirm:null}),o(!0)}catch(a){n({title:"Gagal!",message:a.message,onConfirm:null}),o(!0)}}}),o(!0)},J=async()=>{if(h!==g){B("Passwords tidak sama");return}n({title:"Ubah Password?",message:"Apakah anda yakin untuk mengubah password?",onConfirm:async()=>{try{const a=await c("https://ppgacademicsystem-production.up.railway.app/api/users/change-password","POST",JSON.stringify({email:t.email,oldPassword:f,newPassword:h,confirmNewPassword:g}),{"Content-Type":"application/json",Authorization:"Bearer "+d.token});console.log(a)}catch{}}}),o(!0)},_=()=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("button",{onClick:()=>{o(!1)},className:`${l.onConfirm?"btn-danger-outline":"button-primary mt-0 "} ${s?"opacity-50 cursor-not-allowed":""}`,disabled:s,children:s?e.jsx(m,{}):l.onConfirm?"Batal":"Tutup"}),l.onConfirm&&e.jsx("button",{onClick:l.onConfirm,className:`button-primary mt-0 ${s?"opacity-50 cursor-not-allowed":""}`,children:s?e.jsx(m,{}):"Ya"})]});return e.jsx("div",{className:"container mx-auto p-6 max-w-4xl",children:e.jsxs("div",{className:"card-basic flex flex-col items-stretch mb-12",children:[e.jsxs(X,{isOpen:k,onClose:()=>o(!1),title:l.title,footer:e.jsx(_,{}),children:[s&&e.jsx("div",{className:"flex justify-center",children:e.jsx(m,{size:32})}),!s&&l.message]}),v&&e.jsx(Y,{error:v,onClear:()=>T(null)}),e.jsxs("div",{className:"flex flex-col items-stretch",children:[e.jsx("h1",{className:"text-2xl font-bold self-center mt-4",children:"Profile"}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 justify-around py-2",children:[e.jsx(Q,{customDescription:e.jsx("div",{className:"relative",children:e.jsx("div",{className:"",children:e.jsx(W,{ref:z,accept:".jpg,.jpeg,.png",buttonLabel:e.jsx(p.Icon,{icon:"jam:upload",width:"24",height:"24"}),buttonClassName:`${s&&"hidden"} border border-gray-600 bg-gray-50 size-9 rounded-full absolute offset bottom-7 right-7 md:bottom-9 md:right-9 translate-x-1/2 translate-y-1/2`,imgClassName:`${s&&"animate-pulse"} mt-2 rounded-full size-48 md:size-64 shrink-0`,defaultImageSrc:t!=null&&t.image?`https://ppgacademicsystem-production.up.railway.app/api/${t.image}`:"https://upload.wikimedia.org/wikipedia/commons/7/7c/Profile_avatar_placeholder_large.png?20150327203541",onPick:y})})}),onSubmit:F,disabled:s,reset:!1,footer:!1,button:x&&e.jsx("div",{className:"flex flex-col justify-stretch mt-4",children:e.jsx("button",{type:"submit",className:`button-primary ${s?"opacity-50 cursor-not-allowed":""}`,disabled:s,children:s?e.jsx(m,{children:"Processing..."}):"Simpan Gambar"})})}),e.jsxs("div",{className:"flex flex-col self-center",children:[s&&e.jsx("div",{className:"animate-pulse flex space-x-4 mb-6",children:e.jsxs("div",{className:"flex-1 space-y-6 py-1",children:[e.jsx("div",{className:"h-5 bg-slate-500 rounded"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx("div",{className:"h-3 bg-slate-300 rounded col-span-2"}),e.jsx("div",{className:"h-3 bg-slate-300 rounded col-span-1"})]}),e.jsx("div",{className:"h-3 bg-slate-300 rounded"}),e.jsx("div",{className:"h-3 bg-slate-300 rounded"})]})]})}),!s&&t&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h2",{className:"text-xl font-medium text-gray-800",children:t.name}),e.jsxs("p",{className:"text-gray-600",children:[t.email," ",t.isEmailVerified?e.jsx(p.Icon,{icon:"tdesign:verified",width:"18",height:"18",style:{color:"#06ff00"}}):e.jsxs("a",{onClick:V,className:"p-1 border rounded-md border-red-500 text-gray-500 active:text-primary hover:cursor-pointer italic align-baseline",children:["Belum verifikasi ",e.jsx(p.Icon,{icon:"ci:triangle-warning",width:"16",height:"16",style:{color:"#ff0000"}})]})]}),e.jsxs("p",{className:"text-gray-600",children:["PC ",(C=(N=t==null?void 0:t.teachingGroupId)==null?void 0:N.branchId)==null?void 0:C.name]}),e.jsxs("p",{className:"text-gray-600",children:["KA ",((P=t==null?void 0:t.teachingGroupId)==null?void 0:P.name)||""]})]}),e.jsxs("div",{className:"my-4",children:[e.jsx("h2",{className:"text-base",children:"Ubah Email"}),e.jsxs("div",{className:"flex items-center justify-start",children:[e.jsx("input",{type:"email",value:u,onChange:G,placeholder:"Email Baru",className:"grow mr-2 p-2 my-1 border rounded-[4px] shadow-sm hover:ring-1 hover:ring-primary focus:outline-none focus:ring-2 focus:ring-primary transition-all duration-300 "}),e.jsx("button",{type:"button",className:`button-primary m-0 py-2 inline-block ${s?"opacity-50 cursor-not-allowed":""}`,disabled:s,onClick:q,children:s?e.jsx(m,{}):"Ubah"})]}),b&&e.jsx("p",{className:"text-red-500",children:b})]}),e.jsxs("div",{className:"mb-4 flex flex-col",children:[e.jsx("h2",{className:"text-base",children:"Ubah Password"}),e.jsx("input",{type:"password",value:f,onChange:M,placeholder:"Password Lama",className:"p-2 my-1 border rounded-[4px] shadow-sm hover:ring-1 hover:ring-primary focus:outline-none focus:ring-2 focus:ring-primary transition-all duration-300 "}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:w?"text":"password",value:h,onChange:D,placeholder:"Password Baru",className:"p-2 my-1 border rounded-[4px] shadow-sm hover:ring-1 hover:ring-primary focus:outline-none focus:ring-2 focus:ring-primary transition-all duration-300 w-full"}),e.jsx("span",{onClick:R,className:"absolute inset-y-0 right-0 pr-3 flex items-center cursor-pointer",children:w?e.jsx(p.Icon,{icon:"eva:eye-outline",width:"24",height:"24",className:"text-gray-400 hover:text-black transition-all duration-200"}):e.jsx(p.Icon,{icon:"eva:eye-off-outline",width:"24",height:"24",className:"text-gray-400 hover:text-black transition-all duration-200"})})]}),e.jsx("input",{type:"password",value:g,onChange:L,placeholder:"Konfirmasi Password Baru",className:"p-2 my-1 border rounded-[4px] shadow-sm hover:ring-1 hover:ring-primary focus:outline-none focus:ring-2 focus:ring-primary transition-all duration-300 "}),j&&e.jsx("p",{className:"text-red-500",children:j}),e.jsx("button",{type:"button",className:`button-primary py-2 inline-block ${s?"opacity-50 cursor-not-allowed":""}`,disabled:s,onClick:J,children:s?e.jsx(m,{children:"Processing..."}):"Update"})]})]})]})]})]})})};export{oe as default};
